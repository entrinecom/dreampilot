var $dp,DreamPilot,dp;if(DreamPilot=function(){function t(){jQuery(function(t){return function(){return t.checkDependencies().setupApps()}}(this))}var e,r;return e={},r=t,t.prefix="dp-",t.e=function(t,e){return jQuery(t,e)},t.prototype.e=function(t,e){return r.e(t,e)},t.attribute=function(t){return r.prefix+t},t.selectorForAttribute=function(t){return"["+r.attribute(t)+"]"},t.prototype.checkDependencies=function(){if("undefined"==typeof jQuery)throw"jQuery needed";if("undefined"==typeof jsep)throw"jsep needed";return this},t.prototype.setupApps=function(){return this.e(r.selectorForAttribute($dp.Application.appAttr)).each(function(){var t,n;if(t=r.e(this),n=t.attr(r.attribute($dp.Application.appAttr)),!n)throw"Application can not have an empty name";return null!=e[n]&&$dp.log.error("Application '"+n+"' has been already created"),e[n]=$dp.Application.create(n,t)}),this},t.prototype.getApp=function(t){if(!t)throw"Application name not specified";if(!e[t])throw"Application '"+t+"' not found";return e[t]},t}(),"undefined"!=typeof $dp&&null!==$dp&&"undefined"!=typeof dp&&null!==dp)throw"DreamPilot has been already initialized. May the script be double included?";$dp=DreamPilot,dp=new DreamPilot;var slice=[].slice;DreamPilot.Application=function(){function t(t){this.$wrapper=t,this.setupScope().setupAttributes().setupEvents().init()}var e;return e=t,t.appAttr="app",t.create=function(t,e){var r;return new(r=$dp.fn.stringToFunction(t))(e)},t.prototype.activeElement=null,t.prototype.init=function(){return this},t.prototype.e=function(t){return $dp.e(t,this.getWrapper())},t.prototype.getWrapper=function(){return this.$wrapper},t.prototype.getWrapperData=function(t){return this.getWrapper().data(t)},t.prototype.getScope=function(){return this.Scope},t.prototype.getEvents=function(){return this.Events},t.prototype.getAttributes=function(){return this.Attributes},t.prototype.setActiveElement=function(t){return this.activeElement=t,this},t.prototype.resetActiveElement=function(){return this.setActiveElement(null)},t.prototype.getActiveElement=function(){return this.activeElement},t.prototype.setupScope=function(){return this.Scope=new $dp.Scope,this},t.prototype.setupEvents=function(){return this.Events=new $dp.Events(this),this},t.prototype.setupAttributes=function(){return this.Attributes=new $dp.Attributes(this),this},t.prototype.embraceDomElement=function(t){var e;if(!t)throw"Unable to embrace empty element";return e=$dp.e(t),this.getEvents().setupEvents(e),this.getAttributes().setupAttributes(e),this},t.prototype.linkToScope=function(){var t,e,r,n,o,i;for(r=1<=arguments.length?slice.call(arguments,0):[],t=0,n=r.length;t<n;t++)e=r[t],$dp.fn.isArray(e)?this.linkToScope.apply(this,e):(i=typeof this[e],"function"===i?!function(t){return function(e){return t.getScope().set(e,function(){var r;return r=1<=arguments.length?slice.call(arguments,0):[],t[e].apply(t,r)})}}(this)(e):"undefined"!==i?(o=this[e],this.getScope().set(e,o)):$dp.log.print("Key "+e+" not found in application"));return this},t.prototype.showError=function(t){return alert(t),this},t.prototype.showCollectionLoadError=function(t){return this.showError(t)},t.prototype.showModelLoadError=function(t){return this.showError(t)},t.prototype.showModelSaveError=function(t){return this.showError(t)},t}(),DreamPilot.Attributes=function(){function t(t){this.App=t,this.setupScopePromises().setupAttributes()}var e;return e=t,t.classAttr="class",t.showAttr="show",t.ifAttr="if",t.initAttr="init",t.hrefAttr="href",t.srcAttr="src",t.valueWriteToAttr="value-write-to",t.valueReadFromAttr="value-read-from",t.valueBindAttr="value-bind",t.simpleAttributes=[e.hrefAttr,e.srcAttr],t.prototype.ScopePromises=null,t.prototype.setupScopePromises=function(){return this.ScopePromises=new DreamPilot.ScopePromises,this},t.prototype.setupAttributes=function(t){return null==t&&(t=null),this.setupInitAttribute(t).setupClassAttribute(t).setupShowAttribute(t).setupIfAttribute(t).setupValueBindAttribute(t).setupValueWriteToAttribute(t).setupValueReadFromAttribute(t).setupSimpleAttributes(t)},t.prototype.getApp=function(){return this.App},t.prototype.getScope=function(){return this.getApp().getScope()},t.prototype.getWrapper=function(){return this.getApp().getWrapper()},t.prototype.eachByAttr=function(t,e,r){var n;return null==e&&(e=null),null==r&&(r=null),n=$dp.e($dp.selectorForAttribute(t),e||this.getWrapper()),e&&(n=n.add(e.filter($dp.selectorForAttribute(t)))),n.each(r),this},t.prototype.setupClassAttribute=function(t){var r;return null==t&&(t=null),r=this,this.eachByAttr(e.classAttr,t,function(){var t,n,o,i,s,u,a,p,l;o=this,t=$dp.e(o),p=$dp.Parser.object(t.attr($dp.attribute(e.classAttr)));for(n in p)i=p[n],t.toggleClass(n,$dp.Parser.isExpressionTrue(i,r.getApp(),o,function(t){return function(){return r.classAddPromise(n,i,o)}}(this)));for(l=$dp.Parser.getLastUsedVariables(),u=0,a=l.length;u<a;u++)s=l[u],r.getScope().onChange(s,function(e,s){return t.toggleClass(n,$dp.Parser.isExpressionTrue(i,r.getApp(),o))});return!0}),this},t.prototype.classAddPromise=function(t,e,r){return this.ScopePromises.add({expression:e,app:this.getApp(),scope:this.getScope(),element:r,cb:function(n){return function(n,o,i){var s,u,a,p,l;for(l=[],s=a=p=i.length-1;p<=0?a<=0:a>=0;s=p<=0?++a:--a)l.push(function(){var a,p,l;for(l=[],u=a=p=o.length-1;p<=0?a<=0:a>=0;u=p<=0?++a:--a)l.push(o[u].onChange(i[s],function(o,i){var s;return s=$dp.e(r),s.toggleClass(t,$dp.Parser.isExpressionTrue(e,n,r))}));return l}());return l}}(this)}),this},t.prototype.setupShowAttribute=function(t){var r;return null==t&&(t=null),r=this,this.eachByAttr(e.showAttr,t,function(){var t,n,o,i,s,u,a;for(n=this,t=$dp.e(n),o=t.attr($dp.attribute(e.showAttr)),t.toggle($dp.Parser.isExpressionTrue(o,r.getApp(),n,function(t){return function(){return r.showAddPromise(o,n)}}(this))),a=$dp.Parser.getLastUsedVariables(),s=0,u=a.length;s<u;s++)i=a[s],r.getScope().onChange(i,function(e,i){return t.toggle($dp.Parser.isExpressionTrue(o,r.getApp(),n))});return!0}),this},t.prototype.showAddPromise=function(t,e){return this.ScopePromises.add({expression:t,app:this.getApp(),scope:this.getScope(),element:e,cb:function(r){return function(r,n,o){var i,s,u,a,p;for(p=[],i=u=a=o.length-1;a<=0?u<=0:u>=0;i=a<=0?++u:--u)p.push(function(){var u,a,p;for(p=[],s=u=a=n.length-1;a<=0?u<=0:u>=0;s=a<=0?++u:--u)p.push(n[s].onChange(o[i],function(n,o){var i;return i=$dp.e(e),i.toggle($dp.Parser.isExpressionTrue(t,r,e))}));return p}());return p}}(this)}),this},t.prototype.getReplacerFor=function(t,e){var r;return t.data("replacer")?t.data("replacer"):(r=$("<!-- dp-if: "+e+" --><script type='text/placeholder'></script><!-- end of dp-if: "+e+" -->"),t.data("replacer",r),r)},t.prototype.toggleElementExistence=function(t,e,r){var n;return e?document.body.contains(t.get(0))||(n=this.getReplacerFor(t,r).filter("script"),t.insertAfter(n)):t.after(this.getReplacerFor(t,r)).detach(),this},t.prototype.setupIfAttribute=function(t){var r;return null==t&&(t=null),r=this,this.eachByAttr(e.ifAttr,t,function(){var t,n,o,i,s,u,a;for(n=this,t=$dp.e(n),o=t.attr($dp.attribute(e.ifAttr)),r.toggleElementExistence(t,$dp.Parser.isExpressionTrue(o,r.getApp(),n),o,function(t){return function(){return r.ifAddPromise(o,n)}}(this)),a=$dp.Parser.getLastUsedVariables(),s=0,u=a.length;s<u;s++)i=a[s],r.getScope().onChange(i,function(e,i){return r.toggleElementExistence(t,$dp.Parser.isExpressionTrue(o,r.getApp(),n),o)});return!0}),this},t.prototype.ifAddPromise=function(t,e){var r;return r=this,this.ScopePromises.add({expression:t,app:this.getApp(),scope:this.getScope(),element:e,cb:function(n){return function(n,o,i){var s,u,a,p,l;for(l=[],s=a=p=i.length-1;p<=0?a<=0:a>=0;s=p<=0?++a:--a)l.push(function(){var a,p,l;for(l=[],u=a=p=o.length-1;p<=0?a<=0:a>=0;u=p<=0?++a:--a)l.push(o[u].onChange(i[s],function(o,i){var s;return s=$dp.e(e),r.toggleElementExistence(s,$dp.Parser.isExpressionTrue(t,n,e),t)}));return l}());return l}}(this)}),this},t.prototype.setupInitAttribute=function(t){var r;return null==t&&(t=null),r=this,this.eachByAttr(e.initAttr,t,function(){var t,n,o;return n=this,t=$dp.e(n),o=t.attr($dp.attribute(e.initAttr)),$dp.Parser.executeExpressions(o,r,n),!0}),this},t.prototype.setupValueWriteToAttribute=function(t){var r;return null==t&&(t=null),r=this,this.eachByAttr(e.valueWriteToAttr,t,function(){var t,n,o;return t=$dp.e(this),o=t.attr($dp.attribute(e.valueWriteToAttr)),n=$dp.Parser.getScopeOf(o,r.getScope()),!!e.bindValueCheckScope(o,t,n,r,!1,!0)||e.bindValueWriteToAttribute(o,t,n)}),this},t.prototype.setupValueReadFromAttribute=function(t){var r;return null==t&&(t=null),r=this,this.eachByAttr(e.valueReadFromAttr,t,function(){var t,n,o;return t=$dp.e(this),o=t.attr($dp.attribute(e.valueReadFromAttr)),n=$dp.Parser.getScopeOf(o,r.getScope()),!!e.bindValueCheckScope(o,t,n,r,!0,!1)||e.bindValueReadFromAttribute(o,t,n)}),this},t.prototype.setupValueBindAttribute=function(t){var r;return null==t&&(t=null),r=this,this.eachByAttr(e.valueBindAttr,t,function(){var t,n,o;return t=$dp.e(this),o=t.attr($dp.attribute(e.valueBindAttr)),n=$dp.Parser.getScopeOf(o,r.getScope()),!!e.bindValueCheckScope(o,t,n,r,!0,!0)||(e.bindValueWriteToAttribute(o,t,n),e.bindValueReadFromAttribute(o,t,n))}),this},t.bindValueCheckScope=function(t,r,n,o,i,s){return null==i&&(i=!1),null==s&&(s=!1),null===n&&(o.ScopePromises.add({field:t,scope:o.getScope(),cb:function(n){if(t=$dp.Parser.getPropertyOfExpression(t),s&&e.bindValueWriteToAttribute(t,r,n),i)return e.bindValueReadFromAttribute(t,r,n)}}),!0)},t.bindValueWriteToAttribute=function(t,e,r){var n,o;return n=!e.is("input")||"radio"!==(o=e.attr("type"))&&"checkbox"!==o?"input":"change",e.on(n,function(){var n;return n=$dp.fn.getValueOfElement(e),r.set(t,n)}),$dp.fn.getValueOfElement(e)&&e.trigger(n),!0},t.bindValueReadFromAttribute=function(t,e,r){return r.onChange(t,function(t,r){if($dp.fn.getValueOfElement(e)!==r)return $dp.fn.setValueOfElement(e,r)}),r.get(t)&&r.trigger("change",t),!0},t.prototype.setupSimpleAttributes=function(t){var r;return null==t&&(t=null),r=this,jQuery.each([e.srcAttr,e.hrefAttr],function(n){return function(o,i){return n.eachByAttr(i,t,function(){var t,n,o;return t=$dp.e(this),o=t.attr($dp.attribute(i)),n=$dp.Parser.getScopeOf(o,r.getScope()),!!e.bindAttributeCheckScope(i,o,t,n,r)||e.bindAttribute(i,o,t,n)})}}(this)),this},t.bindAttributeCheckScope=function(t,r,n,o,i){return null===o&&(i.ScopePromises.add({field:r,scope:i.getScope(),cb:function(o){return r=$dp.Parser.getPropertyOfExpression(r),e.bindAttribute(t,r,n,o)}}),!0)},t.bindAttribute=function(t,e,r,n){return n.onChange(e,function(e,n){if(r.attr(t)!==n)return r.attr(t,n)}),n.get(e)&&n.trigger("change",e),!0},t}(),DreamPilot.Collection=function(){function t(){this.defineBasics(),this.init()}return t.prototype.defineBasics=function(){return this.modelClassName=null,this.isIdUnique=!0,this.items={},this.callbacks={load:{}},this},t.prototype.init=function(){return this},t.prototype.getCount=function(){return $dp.fn.arrayCount(this.items)},t.prototype.getItems=function(){return this.items},t.prototype.setApp=function(t){return this.App=t,this},t.prototype.getApp=function(){return this.App},t.prototype.addItems=function(t){var e,r,n;for(r=0,n=t.length;r<n;r++)e=t[r],this.addItem(e);return this},t.prototype.addItem=function(t){var e;return t=this.extendDataBeforeAdd(t),e=this.getNewItem(t),this.putModelToList(e)},t.prototype.extendDataBeforeAdd=function(t){return t},t.prototype.tuneModelAfterCreation=function(t){return t.setApp(this.getApp()),this},t.prototype.getIdForPut=function(t){return this.isIdUnique?t.getId():$dp.fn.arrayCount(this.items)},t.prototype.putModelToList=function(t){var e;return e=this.getIdForPut(t),this.exists(e)?this.items[e].set(t.get()):this.items[e]=t},t.prototype.map=function(t){var e,r,n,o;e=[],o=this.items;for(r in o)n=o[r],"function"===$dp.fn.getType(t)?e.push(t(n,r)):e.push(n.get(t));return e},t.prototype.getIds=function(){return $dp.fn.keys(this.items)},t.prototype.getById=function(t){return this.exists(t)?this.items[t]:this.getNewItem()},t.prototype.exists=function(t){return null!=this.items[t]},t.prototype.getNewItem=function(t){var e,r;return null==t&&(t=null),e=$dp.fn.stringToFunction(this.modelClassName),r=new e(t),this.tuneModelAfterCreation(r),r},t.prototype.getFirstItem=function(){var t;return this.getCount()?(t=this.getIds()[0],this.items[t]):this.getNewItem()},t.prototype.getLoadMethod=function(){return $dp.transport.GET},t.prototype.getLoadUrl=function(){throw"Redefine Collection.getLoadUrl() method first"},t.prototype.getLoadData=function(){return null},t.prototype.load=function(){return $dp.transport.request(this.getLoadMethod(),this.getLoadUrl(),this.getLoadData(),function(t){return function(e){return t.onLoaded(e)}}(this)),this},t.prototype.getKeyForLoadedData=function(){return"items"},t.prototype.checkIfLoadIsOk=function(t){return t.ok},t.prototype.showLoadError=function(t){return this.getApp()?this.getApp().showCollectionLoadError(t.message):alert(t.message),this},t.prototype.filterLoadedData=function(t){return null!=t[this.getKeyForLoadedData()]?t[this.getKeyForLoadedData()]:t},t.prototype.onLoaded=function(t){return this.checkIfLoadIsOk(t)?(this.addItems(this.filterLoadedData(t)).trigger("load"),this):(this.showLoadError(t),this)},t.prototype.on=function(t,e,r){var n,o,i,s;for(null==r&&(r=null),$dp.fn.isArray(t)||(t=[t]),o=0,i=t.length;o<i;o++){for(n=t[o];!r||null!=(null!=(s=this.callbacks[n])?s[r]:void 0);)r=$dp.fn.uniqueId();null==this.callbacks[n]&&(this.callbacks[n]={}),this.callbacks[n][r]=e,r=null}return this},t.prototype.off=function(t,e){var r,n,o;for(null==e&&(e=null),$dp.fn.isArray(t)||(t=[t]),n=0,o=t.length;n<o;n++)r=t[n],e?delete this.callbacks[r][e]:this.callbacks[r]={};return this},t.prototype.trigger=function(t,e){var r,n,o;if(null!=this.callbacks[t]){o=this.callbacks[t];for(n in o)r=o[n],e&&n!==e||r(this)}return this},t.prototype.onLoad=function(t,e){return null==e&&(e=null),this.on("load",t,e)},t}(),DreamPilot.Events=function(){function t(t){this.App=t,this.setupEvents()}var e;return e=t,t.prototype.events=["load","click","dblclick","focus","blur","change","keypress","keyup","keydown","mouseover","mouseout","mousemove","mousedown","mouseup","wheel","paste","input","submit"],t.prototype.getApp=function(){return this.App},t.prototype.getScope=function(){return this.getApp().getScope()},t.prototype.getWrapper=function(){return this.getApp().getWrapper()},t.prototype.setupEvents=function(t){var e,r,n,o;for(null==t&&(t=null),o=this.events,r=0,n=o.length;r<n;r++)e=o[r],this.setupSingleEvent(e,t);return this},t.prototype.setupSingleEvent=function(t,e){var r,n;return null==e&&(e=null),n=this,r=$dp.e($dp.selectorForAttribute(t),e||this.getWrapper()),e&&(r=r.add(e.filter($dp.selectorForAttribute(t)))),r.each(function(){var e,r;return e=$dp.e(this),r=e.attr($dp.attribute(t)),e.on(t,function(t){return t=t||window.event,n.getApp().setActiveElement(this),$dp.Parser.executeExpressions(r,n.getApp(),this,t),n.getApp().resetActiveElement()}),!0}),this},t}(),DreamPilot.Model=function(){function t(t){null==t&&(t={}),this.defineBasics(),this.initFrom(t).init()}return t.prototype.defineBasics=function(){return this.data={},this.relatedData={},this.parent=null,this.parentField=null,this.assignModelToParent=!0,this.assignChildModels=!0,this.saveTimeout=null,this.saveDelay=1e3,this.callbacks={change:{}},this.mainScope=!1,this.idField="id",this.idIsInt=!0,this},t.prototype.init=function(){return this},t.prototype.initFrom=function(t){var e,r;if(null==t&&(t={}),"string"==typeof t&&(t=JSON.parse(t)),"object"!=typeof t)throw"Data should be an object";t instanceof DreamPilot.Model?this.data=$dp.fn.extend(!0,{},t.get()):this.data=$dp.fn.extend(!0,{},t);for(e in t)r=t[e],this.trigger("change",e);return this},t.prototype.setApp=function(t){return this.App=t,this},t.prototype.getApp=function(){return this.App},t.prototype.e=function(t){return this.getApp().e(t)},t.prototype.setParent=function(t,e){if(this.parent=t,this.parentField=e,this.parent&&!this.parent instanceof DreamPilot.Model)throw"Parent can be only DreamPilot.Model";return this},t.prototype.get=function(t){var e,r,n;return null==t&&(t=null),t&&"string"==typeof t&&(r=t.split("."),r.length>1)?(e=r[0],t=r.slice(1).join("."),this.exists(e)?(n=this.data[e],n instanceof DreamPilot.Model?n.get(t):"undefined"!=typeof n[t]?n[t]:null):null):null===t?this.data:this.exists(t)?this.data[t]:null},t.prototype.has=function(t){return!!this.exists(t)&&!!this.data[t]},t.prototype.set=function(t,e){var r,n,o;if(null==e&&(e=null),"object"==typeof t&&null===e)for(r in t)o=t[r],this.set(r,o);else e instanceof DreamPilot.Model&&this.assignChildModels&&e.assignModelToParent&&e.setParent(this,t),n=this.data[t],this.data[t]=e,n!==e&&this.trigger("change",t);return this},t.prototype.exists=function(t){return"undefined"!=typeof this.data[t]},t.prototype.kill=function(t){var e,r,n,o,i,s;if(null==t&&(t=null),null===t)for(o=$dp.fn.keys(this.data),this.data={},r=0,i=o.length;r<i;r++)e=o[r],this.trigger("change",e);else if("array"===$dp.fn.getType(t))for(n=0,s=t.length;n<s;n++)e=t[n],this.kill(e);else null!=this.data[t]&&delete this.data[t],this.trigger("change",t);return this},t.prototype.getId=function(){var t;return t=this.get(this.idField),this.idIsInt&&(t=$dp.fn["int"](t)),t},t.prototype.hasId=function(){return this.has(this.idField)},t.prototype.setId=function(t){return this.idIsInt&&(t=$dp.fn["int"](t)),this.set(this.idField,t)},t.prototype.resetId=function(){return this.setId(null)},t.prototype.getRelated=function(t){return null==t&&(t=null),null===t?this.relatedData:this.existsRelated(t)?this.relatedData[t]:null},t.prototype.hasRelated=function(t){return!!this.existsRelated(t)&&!!this.relatedData[t]},t.prototype.setRelated=function(t,e){var r,n;if(null==e&&(e=null),"object"==typeof t&&null===e)for(r in t)n=t[r],this.setRelated(r,n);else this.relatedData[t]=e;return this},t.prototype.existsRelated=function(t){return"undefined"!=typeof this.relatedData[t]},t.prototype.isMainScope=function(){return this.mainScope},t.prototype.getSaveMethod=function(){return $dp.transport.POST},t.prototype.getSaveUrl=function(){throw"Redefine Model.getSaveUrl() method first"},t.prototype.getSaveData=function(){return this.get()},t.prototype.updateId=function(t){return!this.hasId()&&t&&this.setId(t),this},t.prototype.save=function(){return $dp.transport.request(this.getSaveMethod(),this.getSaveUrl(),this.getSaveData(),function(t){return function(e){return t.tryToUpdateId(e).onSaved(e)}}(this)),this},t.prototype.delayedSave=function(){return this.saveTimeout&&clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(function(t){return function(){return t.save()}}(this),this.saveDelay),this},t.prototype.extractIdFromResult=function(t){return $dp.fn["int"](t.id)},t.prototype.tryToUpdateId=function(t){var e;return e=this.extractIdFromResult(t),this.updateId(e),this},t.prototype.onSaved=function(t){return $dp.log.print("onSaved",t),this},t.prototype.getFetchMethod=function(){return $dp.transport.GET},t.prototype.getFetchUrl=function(){throw"Redefine Model.getFetchUrl() method first"},t.prototype.getFetchData=function(){return null},t.prototype.fetch=function(){return $dp.transport.request(this.getFetchMethod(),this.getFetchUrl(),this.getFetchData(),function(t){return function(e){return t.onFetched(e)}}(this)),this},t.prototype.onFetched=function(t){return $dp.log.print("onFetched",t),this},t.prototype.getDeleteMethod=function(){return{method:$dp.transport.DELETE,dataType:$dp.transport.PAYLOAD}},t.prototype.getDeleteUrl=function(){throw"Redefine Model.getDeleteUrl() method first"},t.prototype.getDeleteData=function(){return null},t.prototype["delete"]=function(){return $dp.transport.request(this.getDeleteMethod(),this.getDeleteUrl(),this.getDeleteData(),function(t){return function(e){return t.onDeleted(e)}}(this)),this},t.prototype.onDeleted=function(t){return $dp.log.print("onDeleted",t),this},t.prototype.on=function(t,e,r,n){var o,i,s,u,a,p,l,c;for(null==n&&(n=null),$dp.fn.isArray(t)||(t=[t]),$dp.fn.isArray(e)||(e=[e]),s=0,a=t.length;s<a;s++)for(o=t[s],u=0,p=e.length;u<p;u++){for(i=e[u];!n||null!=(null!=(l=this.callbacks[o])&&null!=(c=l[i])?c[n]:void 0);)n=$dp.fn.uniqueId();null==this.callbacks[o]&&(this.callbacks[o]={}),null==this.callbacks[o][i]&&(this.callbacks[o][i]={}),this.callbacks[o][i][n]=r,n=null}return this},t.prototype.off=function(t,e,r){var n,o,i,s,u,a;for(null==r&&(r=null),$dp.fn.isArray(t)||(t=[t]),$dp.fn.isArray(e)||(e=[e]),i=0,u=t.length;i<u;i++)for(n=t[i],s=0,a=e.length;s<a;s++)o=e[s],r?delete this.callbacks[n][o][r]:this.callbacks[n][o]={};return this},t.prototype.trigger=function(t,e,r){var n,o,i,s,u,a,p;if(p=this.get(e),null!=(null!=(i=this.callbacks[t])?i[e]:void 0)){s=this.callbacks[t][e];for(o in s)n=s[o],r&&o!==r||n(e,p);this.parent&&this.parent.trigger(t,this.parentField)}if(null!=(null!=(u=this.callbacks[t])?u["*"]:void 0)){a=this.callbacks[t]["*"];for(o in a)n=a[o],r&&o!==r||n(e,p)}return this},t.prototype.onChange=function(t,e,r){return null==r&&(r=null),this.on("change",t,e,r)},t}();var extend=function(t,e){function r(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;DreamPilot.Scope=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return extend(e,t),e.prototype.defineBasics=function(){return e.__super__.defineBasics.call(this),this.mainScope=!0,this},e}(DreamPilot.Model),DreamPilot.Router=function(){function t(t,e){this.App=t,null==e&&(e={}),this.options=$.extend({workMode:r,attrName:"data-step"},e)}var e,r,n;return r=1,n=2,e=null,t.prototype.steps={},t.prototype.when=function(t,e){return null==e&&(e={}),this.steps[t]=e,this},t.prototype["else"]=function(t){return null==t&&(t={}),this.steps[e]=t,this},t}();var slice=[].slice;DreamPilot.Functions=function(){function t(){}var e;return e=t,t.extend=function(){var t;return t=1<=arguments.length?slice.call(arguments,0):[],jQuery.extend.apply(jQuery,t)},t["int"]=function(t){return~~t},t.str=function(t){return t+""},t["float"]=function(t){return parseFloat(t)||0},t.bool=function(t){return!!t},t.trim=function(t){return e.str(t).replace(/^\s+|\s+$/g,"")},t.ltrim=function(t){return e.str(t).replace(/^\s+/,"")},t.rtrim=function(t){return e.str(t).replace(/\s+$/,"")},t.underscore=function(t){return e.str(t).replace(/(\-[a-z])/g,function(t){return t.toUpperCase().replace("-","")})},t.camelize=function(t){return e.str(t).replace(/([A-Z])/g,function(t){return"_"+t.toLowerCase()})},t.urlencode=function(t){return encodeURIComponent(t)},t.urldecode=function(t){return decodeURIComponent(e.str(t).replace(/\+/g,"%20"))},t.parseQueryString=function(t,e,r,n){var o,i,s,u;if(null==t&&(t=window.location.href),null==e&&(e="?"),null==r&&(r="&"),null==n&&(n="="),o={},t.indexOf(e)>-1)for(t=t.substr(t.indexOf(e)+1),"?"===e&&t.indexOf("#")>-1&&(t=t.substr(0,t.indexOf("#"))),i=t.split(r),u=0;u<i.length;)s=i[u].split(n),o[s[0]]=s[1],u++;return o},t.stringToFunction=function(t){var e,r,n,o;e=t.split("."),r=window||this;for(n in e)o=e[n],r=r[o];if("function"!=typeof r)throw"Function/Class "+t+" not found";return r},t.uniqueId=function(t){var e,r,n,o,i;for(i="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=r=0,o=t||32;0<=o?r<=o:r>=o;e=0<=o?++r:--r)i+=n.charAt(Math.floor(Math.random()*n.length));return i},t.randomInt=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},t.formatFloat=function(t,e){var r,n;for(n=Math.pow(10,e),t=Math.round(t*n)/n,r=t.toString().split("."),r[1]=r[1]||"";r[1].length<e;)r[1]+="0";return r[0]+"."+r[1]},t.escapeHtml=function(t){var e;return e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"},t.replace(/[&<>"']/g,function(t){return e[t]})},t.stripTags=function(t,r){var n,o;return null==r&&(r=""),r=(e.str(r).toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join(""),o=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,n=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,t.replace(n,"").replace(o,function(t,e){return r.indexOf("<"+e.toLowerCase()+">")>-1?t:""})},t.round=function(t,e){var r,n,o;return null==e&&(e=0),e?(r=Math.pow(10,e),o=t*r,n=Math.round(o),n/r):Math.round(t)},t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.keys=function(t){return jQuery.map(t,function(t,e){return e})},t.values=function(t){return jQuery.map(t,function(t,e){return t})},t.arraySum=function(t){var e,r;if(r=0,t&&"object"==typeof t&&t.change_key_case)return t.sum.apply(t,Array.prototype.slice.call(arguments,0));if("object"!=typeof t)return null;for(e in t)t.hasOwnProperty(e)&&(isNaN(parseFloat(t[e]))||(r+=parseFloat(t[e])));return r},t.arrayCount=function(t){var e,r;if(e=0,t&&"object"==typeof t&&t.change_key_case)return t.length;if("object"!=typeof t)return null;for(r in t)t.hasOwnProperty(r)&&e++;return e},t.arrayFlip=function(t){var e,r;r={};for(e in t)t.hasOwnProperty(e)&&(r[t[e]]=e);return r},t.arrayShuffle=function(t){var e,r,n;for(e=t.length-1;e>0;)r=Math.floor(Math.random()*(e+1)),n=t[e],t[e]=t[r],t[r]=n,e--;return t},t.arrayReverse=function(t){var e,r,n;for(n=[],r=t.length,e=r-1;e!==-1;)n.push(t[e]),e--;return n},t.arrayUnique=function(t){return jQuery.grep(t,function(e,r){return r===jQuery.inArray(e,t)})},t.lead0=function(t,e){var r;for(null==e&&(e=2),t=this.str(t),r=[];t.length<e;)r.push(t="0"+t);return r},t.digitCase=function(t,r,n,o,i){var s;return null==o&&(o=null),null==i&&(i=!1),null===o&&(o=n),t=e["int"](t),t%10===1&&11!==t?i?r:t+" "+r:2<=(s=t%10)&&s<=4&&12!==t&&13!==t&&14!==t?i?n:t+" "+n:i?o:t+" "+o},t.divide3dig=function(t,r){var n,o,i,s,u,a,p;for(null==r&&(r=","),t=e.str(t),p=t.indexOf("."),s=p!==-1?t.substr(p):"",t=p!==-1?t.substr(0,p):t,u="",a=t.length-3,o=Math.ceil(t.length/3),n=0;n<o;)i=3,a<0&&(i+=a,a=0),u=t.substr(a,i)+r+u,a-=3,n++;return u=u.substr(0,u.length-r.length),u+s},t.basename=function(t,r){var n,o;return null==r&&(r=null),o=t.lastIndexOf("/"),o===-1&&(o=t.lastIndexOf("\\")),n=e.str(t).substr(o+1),"string"==typeof r&&n.substr(n.length-r.length)===r&&(n=n.substr(0,n.length-r.length)),n},t.dirname=function(t){var r;return r=t.lastIndexOf("/"),r===-1&&(r=t.lastIndexOf("\\")),r!==-1?e.str(t).substr(0,r):t},t.fileExt=function(t){return t.split(".").pop()},t.getValueOfElement=function(t){var e;if(!t.is("input"))return t.val()||t.html();switch(t.attr("type")){case"checkbox":return e=t.val(),"on"===e&&(e=!0),t.prop("checked")?e:null;case"radio":if(t.prop("checked"))return t.val();break;default:return t.val()}},t.setValueOfElement=function(t,r){if(t.length)if(t.is("input,select,button"))if(t.is("input"))switch(t.attr("type")){case"checkbox":t.prop("checked",!!r);break;case"radio":t.prop("checked",e.str(t.val())===e.str(r));break;default:t.val(r)}else t.val(r);else t.html(r);return t},t.getType=function(t){return null===t?"null":e.isArray(t)?"array":typeof t},t.print_r=function(t,r){var n,o,i,s,u,a;for(null==r&&(r=0),u="",i="",o=0;o<r;)o++,i+="    ";if("object"===(s=e.getType(t))||"array"===s){for(n in t)a=t[n],u+="object"==typeof a?i+"'"+n+"':\n"+e.print_r(a,r+1):i+"'"+n+"' => \""+a+'"\n';return u?i+"{\n"+u+"\n"+i+"}":"{}"}return i+"("+e.getType(t)+") "+t},t}(),String.prototype.format||(String.prototype.format=function(){var t;return t=arguments,this.replace(/{(\d+)}/g,function(e,r){return"undefined"!=typeof t[r]?t[r]:e})}),$dp&&($dp.fn=DreamPilot.Functions);var slice=[].slice;DreamPilot.Logger=function(){function t(){}return t.print=function(){return console.log.apply(arguments)},t.error=function(){var t;throw t=1<=arguments.length?slice.call(arguments,0):[],t.join(" ")},t}(),$dp&&($dp.log=DreamPilot.Logger);var indexOf=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};DreamPilot.Parser=function(){function t(){}var e;return e=t,t.quotes="'\"`",t.operators={binary:{"+":function(t,e){return t+e},"-":function(t,e){return t-e},"*":function(t,e){return t*e},"/":function(t,e){return t/e},"%":function(t,e){return t%e},">":function(t,e){return t>e},">=":function(t,e){return t>=e},"<":function(t,e){return t<e},"<=":function(t,e){return t<=e},"==":function(t,e){return t==e||!t&&!e},"===":function(t,e){return t===e},"!==":function(t,e){return t!==e},"!=":function(t,e){return t!=e}},unary:{"-":function(t){return-t},"+":function(t){return-t},"!":function(t){return!t}},logical:{"&&":function(t,e){return t&&e},"||":function(t,e){return t||e}}},t.lastUsedVariables=[],t.lastErrors=[],t.lastScopes=[],t.SCOPE_IS_UNDEFINED=1,t.MEMBER_OBJECT_IS_UNDEFINED=2,t.MEMBER_OBJECT_NOT_A_MODEL=3,t.object=function(t,r){var n,o,i,s,u,a,p,l,c,f,d,h;if(null==r&&(r={}),r=$dp.fn.extend({delimiter:",",assign:":",curlyBracketsNeeded:!0},r),t=$dp.fn.trim(t),r.curlyBracketsNeeded){if("{"!==t[0]||"}"!==t.slice(-1))return null;t=t.slice(1,t.length-1)}for(l={},c={key:"",value:""},n=function(){var t;return c.key=$dp.fn.trim(c.key),t=c.key.charAt(0),indexOf.call(e.quotes,t)>=0&&c.key.charAt(0)===c.key.charAt(c.key.length-1)&&(c.key=c.key.substr(1,c.key.length-2)),l[c.key]=c.value,c.key=c.value=""},f=null,h="key",i=a=0,p=t.length;a<p;i=++a)o=t[i],d=!1,u=/\s/.test(o),s=indexOf.call(e.quotes,o)>=0,s&&(f?f&&o===f&&(f=null):f=o),"border"!==h||u?f||(o===r.assign?h="border":o===r.delimiter&&(h="key",n(),d=!0)):h="value","key"!==h&&"value"!==h||d||(c[h]+=o);return(c.key||c.value)&&n(),l},t.evalNode=function(t,r,n,o){var i,s,u,a,p;if(null==n&&(n=null),null==o&&(o=null),!(r instanceof DreamPilot.Model||"Literal"===(p=t.type)||"ThisExpression"===p)){if(!r)return e.addToLastErrors(e.SCOPE_IS_UNDEFINED),o&&o(),!1;throw"Scope should be a DreamPilot.Model instance, but "+$dp.fn.getType(r)+" given: '"+r+"'"}switch(r instanceof DreamPilot.Model&&!r.isMainScope()&&this.addToLastScopes(r),t.type){case"CallExpression":if(null!=t.callee.type&&"Identifier"===t.callee.type&&t.callee.name)return s=function(){var s,u,a,p;for(a=t.arguments,p=[],s=0,u=a.length;s<u;s++)i=a[s],p.push(e.evalNode(i,r,n,o));return p}(),u=r.get(t.callee.name),u&&"function"==typeof u?u.apply(null,s):(u=r[t.callee.name],u&&"function"==typeof u?r[t.callee.name].apply(r,s):$dp.log.error("No function '"+t.callee.name+"' found in scope"));throw"Unable to call node, type: "+t.callee.type+", name: "+t.callee.name;case"BinaryExpression":if("undefined"==typeof e.operators.binary[t.operator])throw"No callback for binary operator "+t.operator;return e.operators.binary[t.operator](e.evalNode(t.left,r,n,o),e.evalNode(t.right,r,n,o));case"UnaryExpression":if("undefined"==typeof e.operators.unary[t.operator])throw"No callback for unary operator "+t.operator;return e.operators.unary[t.operator](e.evalNode(t.argument,r,n,o));case"LogicalExpression":if("undefined"==typeof e.operators.logical[t.operator])throw"No callback for logical operator "+t.operator;return e.operators.logical[t.operator](e.evalNode(t.left,r,n,o),e.evalNode(t.right,r,n,o));case"MemberExpression":return"Literal"===t.property.type&&(t.property.type="Identifier",t.property.name=t.property.value),a=e.evalNode(t.object,r,n,o),a instanceof DreamPilot.Model?e.evalNode(t.property,a,n,o):(e.addToLastErrors(a?e.MEMBER_OBJECT_NOT_A_MODEL:e.MEMBER_OBJECT_IS_UNDEFINED),o&&o(),e.addToLastUsedVariables(t.object.name),null);case"Identifier":switch(t.name){case"$event":return n.dpEvent;default:return e.addToLastUsedVariables(t.name),r instanceof DreamPilot.Model?r.get(t.name):null!=r[t.name]?r[t.name]:null}break;case"Literal":return r?t.value:null;case"ThisExpression":return n;default:throw"Unknown node type "+t.type}},t.getExpressionNamespace=function(t,e){var r;for(null==e&&(e=!1),r=[];;)if(r.push(t.name||t.property.name||t.property.value),!(t=t.object))break;return $dp.fn.arrayReverse(r.slice(e?0:1))},t.getScopeOf=function(t,r){var n,o,i,s,u,a,p;if(u=jsep(t),p=!1,"CallExpression"===u.type&&null!=(null!=(a=u.callee)?a.object:void 0))u=u.callee.object,p=!0;else if("MemberExpression"!==u.type)return r;
for(s=e.getExpressionNamespace(u,p),n=0,i=s.length;n<i&&(o=s[n],r=r.get(o),r);n++);return r},t.getPropertyOfExpression=function(t){var e,r,n;return e=jsep(t),"MemberExpression"===e.type?e.property.name:"CallExpression"===e.type&&null!=(null!=(r=e.callee)&&null!=(n=r.property)?n.name:void 0)?{arguments:e.arguments,callee:e.callee.property,type:e.type}:t},t.isExpressionTrue=function(t,r,n,o){var i;null==n&&(n=r.getActiveElement()),null==o&&(o=null);try{return e.resetLastUsedVariables(),e.resetLastErrors(),e.resetLastScopes(),!!e.evalNode(jsep(t),r.getScope(),n,o)}catch(s){return i=s,$dp.log.error("Expression parsing (isExpressionTrue) error ",i," Full expression:",t),!1}},t.executeExpressions=function(t,r,n,o){var i,s,u,a,p,l,c,f;null==n&&(n=r.getActiveElement()),null==o&&(o=null),f=this.object(t,{delimiter:";",assign:"=",curlyBracketsNeeded:!1}),e.resetLastUsedVariables(),e.resetLastErrors(),e.resetLastScopes(),n.dpEvent=o;for(a in f){u=f[a];try{a.indexOf("(")>-1&&""===u?(i=$dp.Parser.getScopeOf(a,r.getScope()),c=$dp.Parser.getPropertyOfExpression(a),"string"===$dp.fn.getType(c)&&(c=jsep(c)),e.evalNode(c,i,n)):(l=$dp.Parser.getScopeOf(a,r.getScope()),p=$dp.Parser.getPropertyOfExpression(a),i=$dp.Parser.getScopeOf(u,r.getScope()),c=$dp.Parser.getPropertyOfExpression(u),"string"===$dp.fn.getType(c)&&(c=jsep(c)),l.set(p,e.evalNode(c,i,n)))}catch(d){throw s=d}}return!0},t.resetLastUsedVariables=function(){return e.lastUsedVariables=[]},t.inLastUsedVariables=function(t){return e.lastUsedVariables.indexOf(t)!==-1},t.getLastUsedVariables=function(){return e.lastUsedVariables},t.addToLastUsedVariables=function(t){if(t&&!e.inLastUsedVariables(t))return e.lastUsedVariables.push(t)},t.resetLastErrors=function(){return e.lastErrors=[]},t.getLastErrors=function(){return e.lastErrors},t.hasLastErrors=function(){return e.lastErrors.length>0},t.addToLastErrors=function(t){return e.lastErrors.push(t)},t.resetLastScopes=function(){return e.lastScopes=[]},t.getLastScopes=function(){return e.lastScopes},t.hasLastScopes=function(){return e.lastScopes.length>0},t.addToLastScopes=function(t){return e.lastScopes.push(t)},t}(),DreamPilot.ScopePromises=function(){function t(){}return t.prototype.list=[],t.prototype.interval=null,t.prototype.delay=20,t.prototype.add=function(t){var e,r,n;n=this.list;for(e in n)if(r=n[e],null!=r.expression&&null!=t.expression&&r.expression===t.expression)return this;return this.list.push(t),this.initCheck(),this},t.prototype.remove=function(t){return this.list.splice(t,1),this.list.length||this.resetCheck(),this},t.prototype.resetCheck=function(){return clearInterval(this.interval),this},t.prototype.initCheck=function(){return this.interval?this:(this.interval=setInterval(function(t){return function(){var e,r,n,o,i,s,u;i=t.list,s=[];for(n in i)o=i[n],null!=o.expression?($dp.Parser.isExpressionTrue(o.expression,o.app,o.element),$dp.Parser.hasLastErrors()?s.push(void 0):(r=$dp.Parser.getLastScopes(),u=$dp.Parser.getLastUsedVariables(),o.cb(o.app,r,u),s.push(t.remove(n)))):(e=$dp.Parser.getScopeOf(o.field,o.scope),e?(o.cb(e),s.push(t.remove(n))):s.push(void 0));return s}}(this),this.delay),this)},t}();var slice=[].slice;DreamPilot.Transport=function(){function t(){}var e;return e=t,t.GET="GET",t.POST="POST",t.PUT="PUT",t.DELETE="DELETE",t.HEAD="HEAD",t.OPTIONS="OPTIONS",t.CONNECT="CONNECT",t.FORM_DATA=1,t.PAYLOAD=2,t.request=function(t,r,n,o){var i;return i="object"===$dp.fn.getType(t)?$dp.fn.extend({method:e.GET,dataType:e.FORM_DATA,url:r,data:n,success:o},t):{method:t,dataType:e.FORM_DATA,url:r,data:n,success:o},i.dataType===e.PAYLOAD?i=$dp.fn.extend(i,{dataType:"json",contentType:"application/json",data:JSON.stringify(i.data)}):i.dataType===e.FORM_DATA&&delete i.dataType,i.data&&i.method===e.GET&&(i.url+="?"+jQuery.param(i.data),i.data=null),i.type&&!i.dataType&&(i.type=i.dataType),i.type=i.method,delete i.method,jQuery.ajax(i)},t.get=function(){var t;return t=1<=arguments.length?slice.call(arguments,0):[],jQuery.get.apply(jQuery,t)},t.post=function(){var t;return t=1<=arguments.length?slice.call(arguments,0):[],jQuery.post.apply(jQuery,t)},t.postPayload=function(t,r,n){return e.request({method:e.POST,dataType:e.PAYLOAD},t,r,n)},t.put=function(t,r,n){return e.request({method:e.PUT,dataType:e.FORM_DATA},t,r,n)},t.putPayload=function(t,r,n){return e.request({method:e.PUT,dataType:e.PAYLOAD},t,r,n)},t["delete"]=function(t,r,n){return e.request({method:e.DELETE,dataType:e.FORM_DATA},t,r,n)},t.deletePayload=function(t,r,n){return e.request({method:e.DELETE,dataType:e.PAYLOAD},t,r,n)},t}(),$dp&&($dp.transport=DreamPilot.Transport);