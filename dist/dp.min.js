var $dp,DreamPilot,dp;DreamPilot=function(){function t(){$(function(t){return function(){return t.checkDependencies().setupApps()}}(this))}var e,r;return e={},r=t,t.prefix="dp-",t.e=function(t,e){return jQuery(t,e)},t.prototype.e=function(t,e){return r.e(t,e)},t.attribute=function(t){return r.prefix+t},t.selectorForAttribute=function(t){return"["+r.attribute(t)+"]"},t.prototype.checkDependencies=function(){if("undefined"==typeof jQuery)throw"jQuery needed";if("undefined"==typeof jsep)throw"jsep needed";return this},t.prototype.setupApps=function(){return this.e(r.selectorForAttribute($dp.Application.appAttr)).each(function(){var t,n;if(t=r.e(this),n=t.attr(r.attribute($dp.Application.appAttr)),!n)throw"Application with empty name found";return e[n]=$dp.Application.create(n,t)}),this},t}(),$dp=DreamPilot,dp=new DreamPilot,DreamPilot.Application=function(){function t(t){this.$wrapper=t,this.setupScope().setupAttributes().setupEvents()}var e;return e=t,t.appAttr="app",t.create=function(t,e){var r;return new(r=$dp.fn.stringToFunction(t))(e)},t.prototype.getWrapper=function(){return this.$wrapper},t.prototype.getScope=function(){return this.Scope},t.prototype.setupScope=function(){return this.Scope=new $dp.Scope,this},t.prototype.setupEvents=function(){return this.Events=new $dp.Events(this),this},t.prototype.setupAttributes=function(){return this.Attributes=new $dp.Attributes(this),this},t}(),DreamPilot.Attributes=function(){function t(t){this.App=t,this.setupAttributes()}var e;return e=t,t.classAttr="class",t.showAttr="show",t.ifAttr="if",t.initAttr="init",t.prototype.setupAttributes=function(){return this.setupInitAttribute().setupClassAttribute().setupShowAttribute().setupIfAttribute()},t.prototype.getApp=function(){return this.App},t.prototype.getScope=function(){return this.getApp().getScope()},t.prototype.getWrapper=function(){return this.getApp().getWrapper()},t.prototype.setupClassAttribute=function(){var t;return t=this,$dp.e($dp.selectorForAttribute(e.classAttr),this.getWrapper()).each(function(){var r,n,o,i,u,s,p,a;r=$dp.e(this),p=$dp.Parser.object(r.attr($dp.attribute(e.classAttr)));for(n in p)o=p[n],r.toggleClass(n,$dp.Parser.isExpressionTrue(o,t.getApp()));for(a=$dp.Parser.getLastUsedVariables(),u=0,s=a.length;u<s;u++)i=a[u],t.getScope().onChange(i,function(e,i){return r.toggleClass(n,$dp.Parser.isExpressionTrue(o,t.getApp()))});return!0}),this},t.prototype.setupShowAttribute=function(){var t;return t=this,$dp.e($dp.selectorForAttribute(e.showAttr),this.getWrapper()).each(function(){var r,n,o,i,u,s;for(r=$dp.e(this),n=r.attr($dp.attribute(e.showAttr)),r.toggle($dp.Parser.isExpressionTrue(n,t.getApp())),s=$dp.Parser.getLastUsedVariables(),i=0,u=s.length;i<u;i++)o=s[i],t.getScope().onChange(o,function(e,o){return r.toggle($dp.Parser.isExpressionTrue(n,t.getApp()))});return!0}),this},t.prototype.getReplacerFor=function(t,e){var r;return t.data("replacer")?t.data("replacer"):(r=$("<!-- dp-if: "+e+" --><script type='text/placeholder'></script><!-- end of dp-if: "+e+" -->"),t.data("replacer",r),r)},t.prototype.toggleElementExistence=function(t,e,r){var n;return e?document.body.contains(t.get(0))||(n=this.getReplacerFor(t,r).filter("script"),t.insertAfter(n)):t.after(this.getReplacerFor(t,r)).detach(),this},t.prototype.setupIfAttribute=function(){var t;return t=this,$dp.e($dp.selectorForAttribute(e.ifAttr),this.getWrapper()).each(function(){var r,n,o,i,u,s;for(r=$dp.e(this),n=r.attr($dp.attribute(e.ifAttr)),t.toggleElementExistence(r,$dp.Parser.isExpressionTrue(n,t.getApp()),n),s=$dp.Parser.getLastUsedVariables(),i=0,u=s.length;i<u;i++)o=s[i],t.getScope().onChange(o,function(e,o){return t.toggleElementExistence(r,$dp.Parser.isExpressionTrue(n,t.getApp()),n)});return!0}),this},t.prototype.setupInitAttribute=function(){var t;return t=this,$dp.e($dp.selectorForAttribute(e.initAttr),this.getWrapper()).each(function(){var r,n;return r=$dp.e(this),n=r.attr($dp.attribute(e.initAttr)),$dp.Parser.executeExpressions(n,t),!0}),this},t}(),DreamPilot.Events=function(){function t(t){this.App=t,this.setupEvents()}var e;return e=t,t.prototype.events=["click","focus","blur","change","keypress","keyup","keydown","mouseover","mouseout"],t.prototype.setupEvents=function(){var t,e,r,n;for(n=this.events,e=0,r=n.length;e<r;e++)t=n[e],this.setupSingleEvent(t);return this},t.prototype.setupSingleEvent=function(t){var e;return e=this,$dp.e($dp.selectorForAttribute(t),this.App.$element).each(function(){var r,n;return r=$dp.e(this),n=r.attr($dp.attribute(t)),r.on(t,function(t){return $dp.Parser.executeExpressions(n,e.App)}),!0}),this},t}(),DreamPilot.Model=function(){function t(){}var e,r;return r={},e={change:{}},t.prototype.get=function(t){return this.exists(t)?r[t]:null},t.prototype.has=function(t){return!!this.exists(t)&&!!r[t]},t.prototype.set=function(t,n){var o,i,u,s,p,a;if(null==n&&(n=null),"object"==typeof t&&null===n)for(u in t)a=t[u],this.set(u,a);else if(r[t]=n,null!=e.change[t])for(p=e.change[t],i=0,s=p.length;i<s;i++)(o=p[i])(t,n);return this},t.prototype.exists=function(t){return"undefined"!=typeof r[t]},t.prototype.onChange=function(t,r){return null==e.change[t]&&(e.change[t]=[]),e.change[t].push(r),this},t}();var extend=function(t,e){function r(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;DreamPilot.Scope=function(t){function e(){e.__super__.constructor.call(this)}return extend(e,t),e}(DreamPilot.Model),DreamPilot.Functions=function(){function t(){}return t["int"]=function(t){return~~t},t.str=function(t){return t+""},t["float"]=function(t){return parseFloat(t)||0},t.trim=function(t){return t.replace(/^\s+|\s+$/g,"")},t.ltrim=function(t){return t.replace(/^\s+/,"")},t.rtrim=function(t){return t.replace(/\s+$/,"")},t.underscore=function(t){return(t+"").replace(/(\-[a-z])/g,function(t){return t.toUpperCase().replace("-","")})},t.camelize=function(t){return(t+"").replace(/([A-Z])/g,function(t){return"_"+t.toLowerCase()})},t.urlencode=function(t){return encodeURIComponent(t)},t.urldecode=function(t){return decodeURIComponent((t+"").replace(/\+/g,"%20"))},t.stringToFunction=function(t){var e,r,n,o;e=t.split("."),r=window||this;for(n in e)o=e[n],r=r[o];if("function"!=typeof r)throw"Function/Class "+t+" not found";return r},t.uniqueId=function(t){var e,r,n,o,i;for(i="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=r=0,o=t||32;0<=o?r<=o:r>=o;e=0<=o?++r:--r)i+=n.charAt(Math.floor(Math.random()*n.length));return i},t.randomInt=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},t.escapeHtml=function(t){var e;return e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"},t.replace(/[&<>"']/g,function(t){return e[t]})},t.round=function(t,e){var r,n,o;return null==e&&(e=0),e?(r=Math.pow(10,e),o=t*r,n=Math.round(o),n/r):Math.round(t)},t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.keys=function(t){return $.map(t,function(t,e){return e})},t.values=function(t){return $.map(t,function(t,e){return t})},t.lead0=function(t,e){var r;for(null==e&&(e=2),t=this.str(t),r=[];t.length<e;)r.push(t="0"+t);return r},t}(),$dp&&($dp.fn=DreamPilot.Functions);var indexOf=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};DreamPilot.Parser=function(){function t(){}var e;return e=t,t.quotes="'\"`",t.operators={binary:{"+":function(t,e){return t+e},"-":function(t,e){return t-e},"*":function(t,e){return t*e},"/":function(t,e){return t/e},"%":function(t,e){return t%e},">":function(t,e){return t>e},">=":function(t,e){return t>=e},"<":function(t,e){return t<e},"<=":function(t,e){return t<=e},"==":function(t,e){return t==e},"===":function(t,e){return t===e},"!=":function(t,e){return t!=e}},unary:{"-":function(t){return-t},"+":function(t){return-t},"!":function(t){return!t}},logical:{"&&":function(t,e){return t&&e},"||":function(t,e){return t||e}}},t.lastUsedVariables=[],t.object=function(t,r){var n,o,i,u,s,p,a,c,l,f;if(null==r&&(r={}),r=jQuery.extend({delimiter:",",assign:":",curlyBracketsNeeded:!0},r),t=$dp.fn.trim(t),r.curlyBracketsNeeded){if("{"!==t[0]||"}"!==t.slice(-1))return null;t=t.slice(1,t.length-1)}for(p={},a={key:"",value:""},n=function(){return p[$dp.fn.trim(a.key)]=$dp.fn.trim(a.value),a.key=a.value=""},c=null,f="key",i=u=0,s=t.length;u<s;i=++u){if(o=t[i],l=!1,indexOf.call(e.quotes,o)>=0&&(c?c&&o===c&&(c=null,l=!0):(c=o,l=!0)),!c)switch(!1){case o!==r.assign:f="border";break;case!("border"===f&&!/\s/.test(o)):f="value";break;case o!==r.delimiter:f="key",n(),l=!0}"border"===f||l||(a[f]+=o)}return(a.key||a.value)&&n(),p},t.evalNode=function(t,r){switch(t.type){case"BinaryExpression":if("undefined"==typeof e.operators.binary[t.operator])throw"No callback for binary operator "+t.operator;return e.operators.binary[t.operator](e.evalNode(t.left,r),e.evalNode(t.right,r));case"UnaryExpression":if("undefined"==typeof e.operators.unary[t.operator])throw"No callback for unary operator "+t.operator;return e.operators.unary[t.operator](e.evalNode(t.argument,r));case"LogicalExpression":if("undefined"==typeof e.operators.logical[t.operator])throw"No callback for logical operator "+t.operator;return e.operators.logical[t.operator](e.evalNode(t.left,r),e.evalNode(t.right,r));case"Identifier":return e.lastUsedVariables.push(t.name),r.getScope().get(t.name);case"Literal":return t.value;default:throw"Unknown node type "+t.type}},t.isExpressionTrue=function(t,r){var n;try{return e.lastUsedVariables=[],!!e.evalNode(jsep(t),r)}catch(o){return n=o,console.log("Expression parsing (isExpressionTrue) error ",n),!1}},t.executeExpressions=function(t,r){var n,o,i,u;u=this.object(t,{delimiter:";",assign:"=",curlyBracketsNeeded:!1}),e.lastUsedVariables=[];for(i in u){o=u[i];try{i.indexOf("(")>-1&&""===o?(e.evalNode(jsep(i),r),console.log("function: ",i,jsep(i))):(r.getScope().set(i,e.evalNode(jsep(o),r)),console.log("simple assign: ",i,r.getScope().get(i)))}catch(s){n=s,console.log("Expression parsing (executeExpressions) error",n)}}return!0},t.getLastUsedVariables=function(){return e.lastUsedVariables},t}();