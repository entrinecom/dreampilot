var $dp,DreamPilot,dp;DreamPilot=function(){function t(){$(function(t){return function(){return t.checkDependencies().setupApps()}}(this))}var e,r;return e={},r=t,t.prefix="dp-",t.e=function(t,e){return jQuery(t,e)},t.prototype.e=function(t,e){return r.e(t,e)},t.attribute=function(t){return r.prefix+t},t.selectorForAttribute=function(t){return"["+r.attribute(t)+"]"},t.prototype.checkDependencies=function(){if("undefined"==typeof jQuery)throw"jQuery needed";if("undefined"==typeof jsep)throw"jsep needed";return this},t.prototype.setupApps=function(){return this.e(r.selectorForAttribute($dp.Application.appAttr)).each(function(){var t,n;if(t=r.e(this),n=t.attr(r.attribute($dp.Application.appAttr)),!n)throw"Application with empty name found";return e[n]=$dp.Application.create(n,t)}),this},t}(),$dp=DreamPilot,dp=new DreamPilot,DreamPilot.Application=function(){function t(t){this.$element=t,this.setupScope().setupAttributes()}var e;return e=t,t.appAttr="app",t.classAttr="class",t.showAttr="show",t.ifAttr="if",t.initAttr="init",t.create=function(t,e){var r;return new(r=$dp.fn.stringToFunction(t))(e)},t.prototype.getScope=function(){return this.Scope},t.prototype.setupScope=function(){return this.Scope=new $dp.Scope,this},t.prototype.setupAttributes=function(){return this.setupClassAttribute().setupShowAttribute().setupIfAttribute().setupInitAttribute()},t.prototype.setupClassAttribute=function(){var t;return t=this,$dp.e($dp.selectorForAttribute(e.classAttr)).each(function(){var r,n,o,i,u,a,s,p;r=$dp.e(this),s=$dp.Parser.object(r.attr($dp.attribute(e.classAttr)));for(n in s)o=s[n],r.toggleClass(n,$dp.Parser.isExpressionTrue(o,t));for(p=$dp.Parser.getLastUsedVariables(),u=0,a=p.length;u<a;u++)i=p[u],t.getScope().onChange(i,function(e,i){return r.toggleClass(n,$dp.Parser.isExpressionTrue(o,t))});return!0}),this},t.prototype.setupShowAttribute=function(){var t;return t=this,$dp.e($dp.selectorForAttribute(e.showAttr)).each(function(){var r,n,o,i,u,a;for(r=$dp.e(this),n=r.attr($dp.attribute(e.showAttr)),r.toggle($dp.Parser.isExpressionTrue(n,t)),a=$dp.Parser.getLastUsedVariables(),i=0,u=a.length;i<u;i++)o=a[i],t.getScope().onChange(o,function(e,o){return r.toggle($dp.Parser.isExpressionTrue(n,t))});return!0}),this},t.prototype.getReplacerFor=function(t,e){var r;return t.data("replacer")?t.data("replacer"):(r=$("<!-- dp-if: "+e+" --><script type='text/placeholder'></script><!-- end of dp-if: "+e+" -->"),t.data("replacer",r),r)},t.prototype.toggleElementExistence=function(t,e,r){var n;return e?document.body.contains(t.get(0))||(n=this.getReplacerFor(t,r).filter("script"),t.insertAfter(n)):t.after(this.getReplacerFor(t,r)).detach(),this},t.prototype.setupIfAttribute=function(){var t;return t=this,$dp.e($dp.selectorForAttribute(e.ifAttr)).each(function(){var r,n,o,i,u,a;for(r=$dp.e(this),n=r.attr($dp.attribute(e.ifAttr)),t.toggleElementExistence(r,$dp.Parser.isExpressionTrue(n,t),n),a=$dp.Parser.getLastUsedVariables(),i=0,u=a.length;i<u;i++)o=a[i],t.getScope().onChange(o,function(e,o){return t.toggleElementExistence(r,$dp.Parser.isExpressionTrue(n,t),n)});return!0}),this},t.prototype.setupInitAttribute=function(){var t;return t=this,$dp.e($dp.selectorForAttribute(e.initAttr)).each(function(){var r,n;return r=$dp.e(this),n=r.attr($dp.attribute(e.initAttr)),$dp.Parser.executeExpression(n,t),!0}),this},t}(),DreamPilot.Model=function(){function t(){}var e,r;return r={},e={change:{}},t.prototype.get=function(t){return this.exists(t)?r[t]:null},t.prototype.has=function(t){return!!this.exists(t)&&!!r[t]},t.prototype.set=function(t,n){var o,i,u,a,s,p;if(null==n&&(n=null),"object"==typeof t&&null===n)for(u in t)p=t[u],this.set(u,p);else if(r[t]=n,null!=e.change[t])for(s=e.change[t],i=0,a=s.length;i<a;i++)(o=s[i])(t,n);return this},t.prototype.exists=function(t){return"undefined"!=typeof r[t]},t.prototype.onChange=function(t,r){return null==e.change[t]&&(e.change[t]=[]),e.change[t].push(r),this},t}();var extend=function(t,e){function r(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;DreamPilot.Scope=function(t){function e(){e.__super__.constructor.call(this)}return extend(e,t),e}(DreamPilot.Model),DreamPilot.Functions=function(){function t(){}return t.trim=function(t){return t.replace(/^\s+|\s+$/g,"")},t.ltrim=function(t){return t.replace(/^\s+/,"")},t.rtrim=function(t){return t.replace(/\s+$/,"")},t.underscore=function(t){return(t+"").replace(/(\-[a-z])/g,function(t){return t.toUpperCase().replace("-","")})},t.camelize=function(t){return(t+"").replace(/([A-Z])/g,function(t){return"_"+t.toLowerCase()})},t.urlencode=function(t){return encodeURIComponent(t)},t.urldecode=function(t){return decodeURIComponent((t+"").replace(/\+/g,"%20"))},t.stringToFunction=function(t){var e,r,n,o;e=t.split("."),r=window||this;for(n in e)o=e[n],r=r[o];if("function"!=typeof r)throw"Function/Class "+t+" not found";return r},t.uniqueId=function(t){var e,r,n,o,i;for(i="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=r=0,o=t||32;0<=o?r<=o:r>=o;e=0<=o?++r:--r)i+=n.charAt(Math.floor(Math.random()*n.length));return i},t.randomInt=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},t}(),$dp&&($dp.fn=DreamPilot.Functions);var indexOf=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};DreamPilot.Parser=function(){function t(){}var e;return e=t,t.quotes="'\"`",t.operators={binary:{"+":function(t,e){return t+e},"-":function(t,e){return t-e},"*":function(t,e){return t*e},"/":function(t,e){return t/e},"%":function(t,e){return t%e},">":function(t,e){return t>e},">=":function(t,e){return t>=e},"<":function(t,e){return t<e},"<=":function(t,e){return t<=e},"==":function(t,e){return t==e},"===":function(t,e){return t===e},"!=":function(t,e){return t!=e}},unary:{"-":function(t){return-t},"+":function(t){return-t},"!":function(t){return!t}},logical:{"&&":function(t,e){return t&&e},"||":function(t,e){return t||e}}},t.lastUsedVariables=[],t.object=function(t,r){var n,o,i,u,a,s,p,c,f,l;if(null==r&&(r={}),r=jQuery.extend({delimiter:",",assign:":",curlyBracketsNeeded:!0},r),t=$dp.fn.trim(t),r.curlyBracketsNeeded){if("{"!==t[0]||"}"!==t.slice(-1))return null;t=t.slice(1,t.length-1)}for(s={},p={key:"",value:""},n=function(){return s[$dp.fn.trim(p.key)]=$dp.fn.trim(p.value),p.key=p.value=""},c=null,l="key",i=u=0,a=t.length;u<a;i=++u){if(o=t[i],f=!1,indexOf.call(e.quotes,o)>=0&&(c?c&&o===c&&(c=null,f=!0):(c=o,f=!0)),!c)switch(!1){case o!==r.assign:l="border";break;case!("border"===l&&!/\s/.test(o)):l="value";break;case o!==r.delimiter:l="key",n(),f=!0}"border"===l||f||(p[l]+=o)}return(p.key||p.value)&&n(),s},t.isExpressionTrue=function(t,r){var n,o;o=function(t){switch(t.type){case"BinaryExpression":if("undefined"==typeof e.operators.binary[t.operator])throw"No callback for binary operator "+t.operator;return e.operators.binary[t.operator](o(t.left),o(t.right));case"UnaryExpression":if("undefined"==typeof e.operators.unary[t.operator])throw"No callback for unary operator "+t.operator;return e.operators.unary[t.operator](o(t.argument));case"LogicalExpression":if("undefined"==typeof e.operators.logical[t.operator])throw"No callback for logical operator "+t.operator;return e.operators.logical[t.operator](o(t.left),o(t.right));case"Identifier":return e.lastUsedVariables.push(t.name),r.getScope().get(t.name);case"Literal":return t.value;default:throw"Unknown node type "+t.type}};try{return e.lastUsedVariables=[],!!o(jsep(t))}catch(i){return n=i,console.log("Expression parsing error ",n),!1}},t.executeExpression=function(t,e){var r;return r=this.object(t,{delimiter:";",assign:"=",curlyBracketsNeeded:!1}),console.log(r)},t.getLastUsedVariables=function(){return e.lastUsedVariables},t}();